!function(t,o){"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?module.exports=o():t.PortalClient=o()}(this,function(){function t(t){if(this.path=t.path,this.origin=t.origin,this.callbacks={},window.location.origin=window.location.origin||window.location.protocol+"//"+window.location.host,!window.parent.postMessage)throw new Error("Browser does not support postMessage!")}return t.prototype.on=function(t,o){this.callbacks[t]=o},t.prototype.start=function(t){window.addEventListener("message",this.handleMessage.bind(this)),this.insertFrame(t)},t.prototype.handleMessage=function(t){(t.origin||t.originalEvent.origin)===this.origin&&this.callbacks[t.data.type]&&this.callbacks[t.data.type](t.data.payload,this.send.bind(this,t.data.response))},t.prototype.insertFrame=function(t){var o=document.createElement("iframe");o.src=this.origin+this.path+"?src="+encodeURIComponent(window.location.origin),o.style.visibility="hidden",o.style.position="absolute",o.style.top="-100px",o.style.left="-100px",o.onload=function(){this.contentWindow=o.contentWindow,t&&t()}.bind(this),document.body.appendChild(o)},t.prototype.send=function(t,o,n){if(!this.contentWindow)throw new Error("Cannot send event; frame not loaded");var i=!1;n&&(this.on("_RESPONSE_"+t,function(o){i=!0,this.callbacks["_RESPONSE_"+t]=null,n.call(this,null,o)}.bind(this)),window.setTimeout(function(){var o=new Error("Portal callback for "+t+" timed out");i||n(o)},5e3)),this.contentWindow.postMessage({type:t,payload:o,response:"_RESPONSE_"+t},this.origin)},t});